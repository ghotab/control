<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alta de Equipo CCTV</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #007aff; --bg: #ffffff; --text-main: #1d1d1f; --text-sub: #86868b; --border: #f2f2f7; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text-main); margin: 0; padding: 25px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 400px; }
        
        .header { margin-bottom: 30px; }
        .header h1 { font-size: 32px; font-weight: 800; margin: 0; letter-spacing: -1.5px; }
        .header p { color: var(--text-sub); font-size: 17px; margin-top: 5px; }

        .form-group { margin-bottom: 20px; }
        label { display: block; font-size: 13px; font-weight: 700; color: var(--text-sub); text-transform: uppercase; margin-bottom: 8px; margin-left: 5px; }
        
        input, select {
            width: 100%; padding: 16px; border-radius: 18px; border: 1px solid var(--border);
            background: #f5f5f7; font-size: 16px; font-weight: 600; outline: none; box-sizing: border-box; transition: 0.2s;
        }
        input:focus { background: white; border-color: var(--primary); box-shadow: 0 0 0 4px rgba(0,122,255,0.1); }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

        .btn-submit {
            width: 100%; background: var(--primary); color: white; border: none; padding: 18px;
            border-radius: 20px; font-size: 17px; font-weight: 700; cursor: pointer; margin-top: 20px;
            transition: transform 0.2s;
        }
        .btn-submit:active { transform: scale(0.97); }

        /* Estilo para los Switches (Interruptores) */
        .switch-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f5f5f7;
            padding: 12px 18px;
            border-radius: 16px;
            margin-bottom: 10px;
        }
    
        .switch-label {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-main);
        }
    
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }
    
        .switch input { opacity: 0; width: 0; height: 0; }
    
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #d1d1d6;
            transition: .4s;
            border-radius: 34px;
        }
    
        .slider:before {
            position: absolute;
            content: "";
            height: 22px; width: 22px;
            left: 3px; bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
    
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(22px); }
    
        /* Sección Destacada para Conectividad */
        .section-comms {
            background: #f9f9fb;
            border: 2px solid #e5e5ea;
            padding: 20px;
            border-radius: 25px;
            margin-top: 20px;
        }
    
        .section-title {
            font-size: 11px;
            font-weight: 800;
            color: var(--text-sub);
            text-transform: uppercase;
            margin-bottom: 15px;
            display: block;
            letter-spacing: 1px;
        }
        
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Alta de Equipo CCTV</h1>
        <p>Alta en inventario</p>
    </div>

    <form id="formCCTV">
        <div class="form-group">
            <label>Número de Autobús a 5 Dígitos</label>
            <input type="text" id="autobus" 
                   placeholder="Ej. 55175" 
                   inputmode="numeric" 
                   maxlength="5"
                   oninput="validarEco(this)"
                   required>
            <div id="ecoFeedback" style="font-size: 12px; margin-top: 8px; font-weight: 600; color: #ff3b30;">
                <i class="fa-solid fa-circle-xmark"></i> Faltan dígitos (Escribe los 5)
            </div>
        </div>

        <div class="form-group">
            <div class="switch-container">
                <span class="switch-label">¿Tiene CCTV Instalado?</span>
                <label class="switch">
                    <input type="checkbox" id="cctv" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="form-group">
            <label>Modelo del DVR</label>
            <select id="modeloSelect" onchange="checkOtro(this.value)" required>
                <option value="" disabled selected>Selecciona un modelo...</option>
                <option value="MERIVA DVR HIBRIDO 4 AHD 1 IP">MERIVA DVR HIBRIDO 4 AHD 1 IP</option>
                <option value="MERIVA DVR HIBRIDO 4 AHD 4 IP">MERIVA DVR HIBRIDO 4 AHD 4 IP</option>
                <option value="MERIVA DVR 12 CANALES">MERIVA DVR 12 CANALES</option>
                <option value="CAMARA DUAL">CAMARA DUAL</option>
                <option value="OTRO">OTRO (Especificar)</option>
            </select>
        </div>
        
        <div class="form-group" id="groupOtro" style="display: none; animation: fadeIn 0.3s ease;">
            <label>Especificar Modelo</label>
            <input type="text" id="modeloOtro" placeholder="Escribe el modelo aquí...">
        </div>

        <div class="form-group">
            <label>Cantidad de Cámaras</label>
            <input type="number" id="camaras" value="4">
        </div>
        
        <label>Módulos de Hardware</label>
            <div class="grid-2">
                <div class="switch-container">
                    <span class="switch-label">Modulo SIM</span>
                    <label class="switch"><input type="checkbox" id="modSIM"><span class="slider"></span></label>
                </div>
                <div class="switch-container">
                    <span class="switch-label">Modulo WIFI</span>
                    <label class="switch"><input type="checkbox" id="modWIFI"><span class="slider"></span></label>
                </div>
            </div>
            <div class="switch-container">
                <span class="switch-label">Puerto Ethernet Disponible</span>
                <label class="switch"><input type="checkbox" id="ethernet"><span class="slider"></span></label>
            </div>
        
            <div class="section-comms">
                <span class="section-title">Estatus de Transmisión</span>
                
                <div class="switch-container" style="background: white;">
                    <span class="switch-label">Visualización en CEIBA</span>
                    <label class="switch">
                        <input type="checkbox" id="ceiba">
                        <span class="slider"></span>
                    </label>
                </div>
        
                <div class="form-group" style="margin-top:15px;">
                    <label>Medio de Comunicación</label>
                    <select id="comunicacion">
                        <option value="SIM">SIM (Datos móviles)</option>
                        <option value="WIFI">WIFI</option>
                        <option value="ETHERNET">Ethernet</option>
                        <option value="N/A">No aplica / Sin conexión</option>
                    </select>
                </div>
            </div>
        
            <button type="submit" class="btn-submit">Guardar Registro</button>
        </form>


</div>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbyMuxH67AHrzkLmejBuC5pWEYmUhFrOED1A3lHqq448u3T55WbUIvvW9PRay7TzjwE8LQ/exec';
    const form = document.getElementById('formCCTV');

    // Validación de 5 dígitos (GHO, TUSA, etc.)
    function validarEco(input) {
        input.value = input.value.replace(/[^0-9]/g, '');
        const feedback = document.getElementById('ecoFeedback');
        const submitBtn = document.querySelector('.btn-submit');
        
        if (input.value.length === 5) {
            feedback.style.color = "#34c759";
            feedback.innerHTML = '<i class="fa-solid fa-circle-check"></i> Formato correcto';
            submitBtn.style.opacity = "1";
            submitBtn.disabled = false;
        } else {
            feedback.style.color = "#ff3b30";
            feedback.innerHTML = '<i class="fa-solid fa-circle-xmark"></i> El número debe ser de 5 dígitos';
            submitBtn.style.opacity = "0.5";
            submitBtn.disabled = true;
        }
    }

    // Inicialización de página
    window.onload = () => {
        const btn = document.querySelector('.btn-submit');
        btn.disabled = true;
        btn.style.opacity = "0.5";
    };

    // Lógica para opción "OTRO" en modelos
    function checkOtro(val) {
        const groupOtro = document.getElementById('groupOtro');
        const inputOtro = document.getElementById('modeloOtro');
        if (val === 'OTRO') {
            groupOtro.style.display = 'block';
            inputOtro.required = true;
            inputOtro.focus();
        } else {
            groupOtro.style.display = 'none';
            inputOtro.required = false;
            inputOtro.value = "";
        }
    }
    
    // ENVÍO DE FORMULARIO
    form.addEventListener('submit', e => {
        e.preventDefault();
        
        const submitBtn = e.target.querySelector('.btn-submit');
        const inputEco = document.getElementById('autobus');

        // Doble validación de seguridad para los 5 dígitos
        if (inputEco.value.length !== 5) {
            alert("⚠️ Error: El económico DEBE ser de 5 dígitos completos.");
            return;
        }
        
        submitBtn.disabled = true;
        submitBtn.innerText = 'Guardando en Base de Datos...';
        
        // Función ayudante para leer los Switches (Checkboxes)
        const getSwitchVal = (id) => document.getElementById(id).checked ? "SÍ" : "NO";

        // Determinar modelo final
        const modeloFinal = document.getElementById('modeloSelect').value === 'OTRO' 
            ? document.getElementById('modeloOtro').value 
            : document.getElementById('modeloSelect').value;
        
        // Mapeo exacto de los datos para el Apps Script
        const datos = {
            autobus: inputEco.value,
            cctv: getSwitchVal('cctv'),
            modelo: modeloFinal,
            camaras: document.getElementById('camaras').value,
            modSIM: getSwitchVal('modSIM'),
            modWIFI: getSwitchVal('modWIFI'),
            ethernet: getSwitchVal('ethernet'),
            ceiba: getSwitchVal('ceiba'),
            comunicacion: document.getElementById('comunicacion').value
        };

        // Ejecución del envío
        fetch(scriptURL, {
            method: 'POST',
            mode: 'no-cors', // Evita errores de CORS en navegadores
            cache: 'no-cache',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(datos)
        })
        .then(() => {
            alert('✅ Registro guardado exitosamente en CCTV');
            form.reset();
            // Resetear visualmente el validador y botón
            validarEco(inputEco); 
            submitBtn.innerText = 'Guardar Registro';
        })
        .catch(error => {
            alert('❌ Error al conectar con el servidor');
            console.error('Error!', error.message);
            submitBtn.disabled = false;
            submitBtn.innerText = 'Reintentar Guardar';
        });
    });
</script>
    
</body>
</html>
