<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carga Masiva de SIMS</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #007aff; --bg: #ffffff; --text-main: #1d1d1f; --text-sub: #86868b; --border: #f2f2f7; --green: #34c759; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text-main); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 400px; }
        
        .header { margin-bottom: 25px; }
        .header h1 { font-size: 28px; font-weight: 800; margin: 0; letter-spacing: -1px; }
        .header p { color: var(--text-sub); font-size: 16px; margin-top: 5px; }

        /* Contenedores tipo iPhone Settings */
        .section-box { background: #f5f5f7; border-radius: 20px; padding: 15px; margin-bottom: 20px; border: 1px solid var(--border); }
        label { display: block; font-size: 11px; font-weight: 800; color: var(--text-sub); text-transform: uppercase; margin-bottom: 8px; margin-left: 5px; }
        
        input, select, textarea {
            width: 100%; padding: 14px; border-radius: 12px; border: 1px solid var(--border);
            background: white; font-size: 16px; font-weight: 600; outline: none; box-sizing: border-box; margin-bottom: 10px;
        }

        /* Área de escaneo masivo */
        .scan-area {
            border: 2px dashed var(--primary);
            background: #f0f7ff !important;
            font-family: monospace;
            font-size: 14px;
            resize: none;
        }

        .counter-badge {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 800;
            margin-bottom: 10px;
        }

        .btn-submit {
            width: 100%; background: var(--primary); color: white; border: none; padding: 18px;
            border-radius: 18px; font-size: 17px; font-weight: 700; cursor: pointer; transition: 0.3s;
        }

        .btn-submit:disabled { background: #d1d1d6; cursor: not-allowed; }

        .status-msg { margin-top: 15px; text-align: center; font-size: 14px; font-weight: 600; display: none; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Entrada Masiva</h1>
        <p>Registro de lote de SIMS</p>
    </div>

    <form id="formMasivo">
        <div class="section-box">
            <label>Datos del Proveedor</label>
            <select id="compania" required>
                <option value="Telcel">Telcel</option>
                <option value="Yumovil">Yumovil</option>
                <option value="ATT">ATT</option>
                <option value="Unefon">Unefon</option>
                <option value="Movistar">Movistar</option>
            </select>
            <input type="text" id="remitente" placeholder="¿Quién envía el lote?" required>
            <label>Fecha de Recepción</label>
            <input type="date" id="fechaRecibido" required>
        </div>

        <div class="section-box">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <label>Lista de IMEIs</label>
                <div id="badge" class="counter-badge">0 Detectadas</div>
            </div>
            <textarea id="listaImeis" class="scan-area" rows="10" 
                      placeholder="Escanea o pega aquí los IMEIs... (uno por línea)"></textarea>
            <p style="font-size: 11px; color: var(--text-sub); margin-left: 5px;">
                * Si usas escáner de pistola, los IMEIs se enlistarán solos.
            </p>
        </div>

        <div class="section-box">
            <label>Comentarios del Lote</label>
            <input type="text" id="comentarios" placeholder="Ej: Lote mensual de 50 chips">
        </div>

        <button type="submit" id="btnEnviar" class="btn-submit">Registrar Todo el Lote</button>
        <div id="status" class="status-msg"></div>
    </form>
</div>



<script>
    const scriptURL = 'TU_NUEVA_URL_DE_APPS_SCRIPT'; // <--- PEGA AQUÍ TU URL
    const form = document.getElementById('formMasivo');
    const txtArea = document.getElementById('listaImeis');
    const badge = document.getElementById('badge');

    // Poner fecha de hoy
    document.getElementById('fechaRecibido').valueAsDate = new Date();

    // Contador de líneas en tiempo real
    txtArea.addEventListener('input', () => {
        const lineas = txtArea.value.split('\n').filter(l => l.trim() !== "");
        badge.innerText = `${lineas.length} Detectadas`;
        badge.style.background = lineas.length > 0 ? "var(--green)" : "var(--primary)";
    });

    form.addEventListener('submit', e => {
        e.preventDefault();
        
        const lineas = txtArea.value.split('\n').filter(l => l.trim() !== "");
        if (lineas.length === 0) {
            alert("⚠️ Por favor, escanea al menos una SIM.");
            return;
        }

        const btn = document.getElementById('btnEnviar');
        const status = document.getElementById('status');
        
        btn.disabled = true;
        btn.innerText = "Procesando Lote...";
        status.style.display = "block";
        status.style.color = "var(--primary)";
        status.innerText = "⏳ Enviando datos a Google Sheets...";

        const datos = {
            accion: "RECEPCION",
            imeis: lineas, // Enviamos el array
            compania: document.getElementById('compania').value,
            remitente: document.getElementById('remitente').value,
            fecha: document.getElementById('fechaRecibido').value,
            comentarios: document.getElementById('comentarios').value
        };

        fetch(scriptURL, {
            method: 'POST',
            mode: 'no-cors',
            cache: 'no-cache',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(datos)
        })
        .then(() => {
            status.style.color = "var(--green)";
            status.innerHTML = "✅ ¡Lote registrado con éxito!";
            alert(`Se han registrado ${lineas.length} SIMS en el sistema.`);
            form.reset();
            badge.innerText = "0 Detectadas";
            badge.style.background = "var(--primary)";
            btn.disabled = false;
            btn.innerText = "Registrar Todo el Lote";
            document.getElementById('fechaRecibido').valueAsDate = new Date();
        })
        .catch(error => {
            status.style.color = "red";
            status.innerText = "❌ Error al enviar el lote.";
            btn.disabled = false;
            btn.innerText = "Reintentar Envío";
            console.error('Error!', error.message);
        });
    });
</script>

</body>
</html>
